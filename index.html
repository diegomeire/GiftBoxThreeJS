<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Babylon Template</title>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 60%;
                height: 60%;
                touch-action: none;
            }
        </style>

        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
        <script src="//preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
        
    </head>

   <body>

       <div>
        <form id="gui" > 
        <br>    
        <label for="template">Choose box:</label>
        <select name="boxPicker" id="boxPicker" onChange="onBoxChange(this.Value)">
          <option value="Box01.gltf">Template 01</option>
          <option value="Box02.gltf">Template 02</option>
          <option value="Box03.gltf">Template 03</option>
          <option value="Box04.gltf">Template 04</option>
          <option value="Box05.gltf">Template 05</option>
          <option value="Box06.gltf">Template 06</option>
          <option value="Box07.gltf">Template 07</option>
          <option value="Box08.gltf">Template 08</option>
          <option value="Box09.gltf">Template 09</option>
          <option value="Box10.gltf">Template 10</option>

            
          <option value="Box11.gltf">Template 11</option>
          <option value="Box12.gltf">Template 12</option>
          <option value="Box13.gltf">Template 13</option>
          <option value="Box14.gltf">Template 14</option>
          <option value="Box15.gltf">Template 15</option>
          <option value="Box16.gltf">Template 16</option>
          <option value="Box17.gltf">Template 17</option>
          <option value="Box18.gltf">Template 18</option>
          <option value="Box19.gltf">Template 19</option>
          <option value="Box20.gltf">Template 20</option>

          <option value="Box21.gltf">Template 21</option>
          <option value="Box22.gltf">Template 22</option>
          <option value="Box23.gltf">Template 23</option>
          <option value="Box24.gltf">Template 24</option>
          <option value="Box25.gltf">Template 25</option>


        </select>


        <br>
        <br>
        <input type="text" id="lname" name="lname" value="Teste" onkeydown="changeText(this.value)">
        <br><br>
            
            
        </form>
           <canvas id="renderCanvas" touch-action="none"></canvas> <!-- touch-action="none" for best results from PEP -->

    </div>
       
    
    <script>
        var canvas = document.getElementById("renderCanvas"); // Get the canvas element
        var engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine
        var scene = new BABYLON.Scene(engine);
        var camera = new BABYLON.ArcRotateCamera("Camera", 1, 1, 5, new BABYLON.Vector3(0, 0, 0), scene);
        var box = null;

        var planeWidth = 0.25;
        var planeHeight = 0.25;

        var writingPlane = BABYLON.MeshBuilder.CreatePlane("plane", {width:planeWidth, height:planeHeight}, scene);
        var size = 512;
        var dynamicTexture = new BABYLON.DynamicTexture("DynamicTexture", size, scene);
        var font_size = 96;
        var font_type = "Arial";
        var font = font_size + "px " + font_type;
        


        function changeBox( value ){
            
            if (scene != null){
                scene.dispose();
                scene = new BABYLON.Scene(engine);
                camera = new BABYLON.ArcRotateCamera("Camera", 1, 1, 2, new BABYLON.Vector3(0, 0, 0), scene);
                
                
                scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);
                scene.ambientColor = new BABYLON.Color3(1.0, 1.0, 1.0);
                camera.setTarget(BABYLON.Vector3.Zero());

                camera.lowerRadiusLimit = 1;
                camera.upperRadiusLimit = 50;
                camera.attachControl(canvas, true);
                
                // This creates a light, aiming 0,1,0 - to the sky (non-mesh)
                var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);
                // Default intensity is 1. Let's dim the light a small amount
                light.intensity = 0.7;

            }
            
            //Create plane
            writingPlane = BABYLON.MeshBuilder.CreatePlane("plane", {width:planeWidth, height:planeHeight}, scene);
            writingPlane.rotation = new BABYLON.Vector3( 1.5708, 0, 0 );
            writingPlane.position.y = 0.271;
            if (dynamicTexture != null){
                dynamicTexture.dispose();
            }
            dynamicTexture = new BABYLON.DynamicTexture("DynamicTexture", size, scene);
            
            //Draw text
            changeText();
            
            //create material
            var mat = new BABYLON.StandardMaterial("mat", scene);
            mat.diffuseTexture = dynamicTexture;
            mat.diffuseTexture.hasAlpha = true;

            //apply material
            writingPlane.material = mat;
            
            console.log( value );
            
            box = BABYLON.SceneLoader.Append("./models/", value, scene, () => {
                console.log()
                scene.createDefaultCameraOrLight(true, true, true);
                camera = scene.camera;
              //  camera = new BABYLON.ArcRotateCamera("Camera", 1, 1, 5, new BABYLON.Vector3(0, 1, 0), scene);
                
                //    scene.createDefaultEnvironment();
            });
                  
        }
        
        
        // *********************
        // Event - onBoxChange
        function onBoxChange(){
            if (document.getElementById( 'boxPicker' ).value == "Box01.gltf"){
                size = 512;
            }
            if (document.getElementById( 'boxPicker' ).value == "Box02.gltf"){
                size = 256;
            }
            console.log( size );
            changeBox( document.getElementById( 'boxPicker' ).value );
            changeText();
            camera.position.y = 2;
        }
        // *********************
        
        
        // *********************
        function changeText(){
            if (document.getElementById( 'boxPicker' ).value == "Box01.gltf"){
                dynamicTexture.drawText(document.getElementById( 'lname' ).value, null, null, font, "#008000", "transparent", true);
            }
            if (document.getElementById( 'boxPicker' ).value == "Box02.gltf"){
                dynamicTexture.drawText(document.getElementById( 'lname' ).value, null, null, font, "#FF0000", "transparent", true);
            }
            else{
                dynamicTexture.drawText(document.getElementById( 'lname' ).value, null, null, font, "#000000", "transparent", true);
            }
        }
        // *********************
        
        
        changeBox( "Box01.gltf" );
        
        

        // Register a render loop to repeatedly render the scene
        engine.runRenderLoop(function () {
                scene.render();
        });

        // Watch for browser/canvas resize events
        window.addEventListener("resize", function () {
                engine.resize();
        });
    </script>

   </body>

</html>