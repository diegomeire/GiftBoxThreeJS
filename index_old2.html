<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Babylon Template</title>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 50%;
                height: 50%;
                touch-action: none;
            }
        </style>

        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
        <script src="//preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
    </head>

   <body>

       <div>
        <form id="gui" > Scale
        <input type="range" id="scale" name="Scale" min="50" max="500" value="100"><br>

        <br>
        <label for="wrapColor">Choose a ribbon color:</label>
        <select name="wrapColor" id="wrapColor">
          <option value="green">Green</option>
          <option value="blue">Blue</option>
          <option value="red">Red</option>
        </select>


        <br>
        <br>

        <label for="ribbonColor">Choose a wrap color:</label>
        <select name="ribbonColor" id="ribbonColor">
          <option value="green">Green</option>
          <option value="blue">Blue</option>
          <option value="red">Red</option>
        </select>

        <br><br>
            
        <input type="text" id="lname" name="lname" value="Teste"> <!-- onchange="myFunction(this.value)" -->
        <br><br>
            
            
        </form>
           <canvas id="renderCanvas" touch-action="none"></canvas> <!-- touch-action="none" for best results from PEP -->

    </div>
       
    
    <script>
        var canvas = document.getElementById("renderCanvas"); // Get the canvas element
        var engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine
        
        /******* Add the create scene function ******/
       var createScene = function () {

                    var scene = new BABYLON.Scene(engine);

                    scene.clearColor = new BABYLON.Color4(0.5, 0.8, 0.5, 0);
                    var camera = new BABYLON.ArcRotateCamera("Camera", 1, 0.8, 5, new BABYLON.Vector3(0, 0, 0), scene);
                    camera.setTarget(BABYLON.Vector3.Zero());
           
                    camera.lowerRadiusLimit = 2;
                    camera.upperRadiusLimit = 5;
                    camera.attachControl(canvas, true);

                    var light       = new BABYLON.PointLight("sad",new BABYLON.Vector3(25,25,25),scene);
                    light.specular  = new BABYLON.Color3(0,0,0);
                    var light2      = new BABYLON.PointLight("sad",new BABYLON.Vector3(-25,-25,-25),scene);
                    light2.specular = new BABYLON.Color3(0,0,0);

                   // var box = new BABYLON.MeshBuilder.CreateBox("box", {height: 1, width: 1}, scene);

                    //creates a new canvas that is used as an ambientTexture
                    var textCanvas    = document.createElement('canvas');
                    textCanvas.width  = 512;
                    textCanvas.height = 512;

                    //the material of the box with ambientTexture and diffuseTexture
                    boxMaterial                = new BABYLON.StandardMaterial("texture", scene);
                    boxMaterial.ambientTexture = new BABYLON.DynamicTexture("dynamic", textCanvas, scene, true);
                    boxMaterial.diffuseTexture = new BABYLON.Texture("img/Crate.png",scene);
                   // box.material = boxMaterial;

                    //the context of the canvas
                    var context       = textCanvas.getContext("2d");

                    //standard is black => mesh is black, need to be recoulered
                    context.fillStyle = "white";
                    context.fillRect(0,0,textCanvas.width, textCanvas.height);

                    //the black is used for the text
                    context.fillStyle = "black";
                    context.font      = "100px serif";

                    //writes the text on the canvas
                    context.fillText(  document.getElementById( 'lname' ).value, 128, 256);
           
                    var DTWidth = 0.665;
                    var DTHeight = 1;
                    var dynamicTexture = new BABYLON.DynamicTexture("DynamicTexture", {width:DTWidth, height:DTHeight}, scene);
           
                    var ctx = dynamicTexture.getContext();
                    var size = 12; //any value will work
                    ctx.font = "100px serif";
                    var textWidth = ctx.measureText(document.getElementById( 'lname' ).value).width;
           
                    var ratio = textWidth/size;

                    var font_size = Math.floor(DTWidth / ratio); 
           
                    var font_size = Math.floor(DTWidth / (ratio * 1.1)); 
           
                    var font = "100px serif";
                    dynamicTexture.drawText( document.getElementById( 'lname' ).value , null, null, font, "#000000", "#ffffff", true);
           
                    var plane = BABYLON.MeshBuilder.CreatePlane("plane", {height:1, width: 0.665, sideOrientation: BABYLON.Mesh.DOUBLESIDE}, scene);
                    var mat = new BABYLON.StandardMaterial("mat", scene);
                    mat.diffuseTexture = dynamicTexture;
                    plane.material = mat;
           
                //    box.material.ambientTexture.update();
           
           
           return scene;

        };
        /******* End of the create scene function ******/

        var scene = createScene(); //Call the createScene function

        // Register a render loop to repeatedly render the scene
        engine.runRenderLoop(function () {
                scene.render();
        });

        // Watch for browser/canvas resize events
        window.addEventListener("resize", function () {
                engine.resize();
        });
    </script>

   </body>

</html>